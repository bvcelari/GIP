{% extends "proveedor/base_bootstrap_proveedor.html" %}
{% load staticfiles %}
{% block purejavascript %}

    <!-- el editor -->
    <script src="http://js.nicedit.com/nicEdit-latest.js" type="text/javascript"> </script>
    <script type="text/javascript">bkLib.onDomLoaded(function() { new nicEditor(   {buttonList : ['fontSize', 'bold', 'italic', 'underline','left','center','right','justify','ol','ul','fontSize','fontFamily','fontFormat','indent','outdent', 'strikeThrough', 'subscript', 'superscript']}).panelInstance('texcontenido'); });
    </script>
<script>

//combo_option[combo_option.selectedIndex].id

//Javascript to collect info from form id = search_form
function submitform(page) {
  page = page || 0;
  dirty = 0;
  myform = document.forms["search_cat"];
  myform.page = '{{ product_list.number }}';
  cat = document.getElementById('categoria').options;

  cat_id = cat[cat.selectedIndex].id
  //really hand made :( TODO: use jquery and handle the string from menus too, so they will always fit. Get the originals from jinja templates
  // cat_id == 0 //is the default choose a category
  
  if ( cat_id != 0 )
  {
    addHidden(myform,'categoria', cat_id)
    dirty = 1;
  }

  if (document.getElementById('subcategoria'))
  {
    subcat = document.getElementById('subcategoria').options
    subcat_id = subcat[subcat.selectedIndex].id

    if (subcat_id != 0 )
    {
      addHidden(myform,'subcategoria', subcat_id)
      dirty = 1;
    }
  }

  if (document.getElementById('search').value != "")
  {
    if (document.getElementById('search').value.length < 3)
    {
      alert('Por favor, introduce al menos 3 caracteres')
      return;
    }
    addHidden(myform,'search', document.getElementById('search').value)

    dirty = 1;
  }
  if (page != 0 ){
    addHidden(myform,'page', page)
    dirty = 1
  }
  if (dirty == 0 )
  {
    alert('Por favor, introduce algun filtro');
    return;
  }
  //paginate using the form 
  myform.submit();
  
}

function addHidden(theForm, key, value) {
    // Create a hidden input element, and append it to the form:
    var input = document.createElement('input');
    input.type = 'hidden';
    input.name = key;'name-as-seen-at-the-server';
    input.value = value;
    theForm.appendChild(input);
}

function populate_form() {
search_string = '{{ search_parameters.search }}';
  if ( search_string != ''){
    document.getElementById('search').value = search_string;
  }

categoria = '{{ search_parameters.categoria }}';
  if ( categoria != ''){
    for (i = 0; i< document.getElementById('categoria').length; i++)
      {
        if (document.getElementById('categoria').options[i].id == categoria )
        {
          // Item is found. Set its property and exit
          document.getElementById('categoria').options[i].selected = true;
          break;
        }
      }
  }

subcategoria = '{{ search_parameters.subcategoria }}';
  if ( subcategoria != ''){
    for (i = 0; i< document.getElementById('subcategoria').length; i++)
      {
        if (document.getElementById('subcategoria').options[i].id == subcategoria )
        {
          // Item is found. Set its property and exit
          document.getElementById('subcategoria').options[i].selected = true;
          break;
        }
      }
  }



}

$(document).ready(function() {
var form = $('#send_lista_info');
populate_form();

});
</script>
{% endblock %}

<div class="container">
{% block left_menu_producto %}
{% endblock %}

{% block content %}

{% block dataset %}
          <div class="col-md-9">
            <h4>Editar producto</h4>
            <form class="form-horizontal">
                    <fieldset>
                      <div class="form-group">
                        <label for="Referencia" class="col-lg-2 control-label">Referencia</label>
                        <div class="col-lg-10">
                          <input class="form-control"  type="text" value="{{ producto.product_ref }}">
                        </div>
                      </div>
                      <div class="form-group">
                        <label for="Nombre_Comercial" class="col-lg-2 control-label">Nombre</label>
                        <div class="col-lg-10">
                          <input class="form-control" placeholder="Nombre Comercial" type="text" value="{{ producto.nombre }}"> 
                        </div>
                      </div>
                      <div class="form-group">
                        <label for="Categoria" class="col-lg-2 control-label">Categoria</label>
                        <div class="col-lg-10">
                          <select name="Categoria" class="form-control" id="categoria">
                            <option id='0' class=''> Elige una categoria </option>
        {% for categoria in categorias_list %}
            <option id='cat_{{ categoria.id }}' value="{{categoria.id}}" class={{ categoria.id }}> {{ categoria.nombre }} </option>
        {% endfor %}
                          </select>

                        </div>
                      </div>
                      <div class="form-group">
                        <label for="Formato" class="col-lg-2 control-label">Formato</label>
                        <div class="col-lg-10">
                          <input class="form-control" placeholder="Formato" type="text" value="{{ producto.formato  }}">
                        </div>
                      </div>
                      <div class="form-group">
                        <label for="Cantidad_minima" class="col-lg-2 control-label">Cantidad Minima</label>
                        <div class="col-lg-10">
                          <input class="form-control" placeholder="Cantidad Minima" type="text" value="{{ producto.cantidad_minima }}">
                        </div>
                      </div>
{% for tarifa in edit_producto %}
                      <div class="form-group">
                        <label for="{{ tarifa.tarifa }}" class="col-lg-2 control-label">{{ tarifa.tarifa }}</label>
                        <div class="col-lg-10">
                          <input id="prod_{{tarifa.id}}_tarifa_{{tarifa.tarifa.id}}" class="form-control" placeholder="Tarifa 1" type="text" value="{{ tarifa.precio }}">
                        </div>
                      </div>

{% endfor %} 
                      <div class="form-group">
                        <label class="col-lg-2 control-label" for="Descripción">Descripción</label>
                        <div class="col-lg-10">
                          <div class="form-group"method="post">
    <textarea class="form-control" rows="3"id="texcontenido">{{ producto.especificaciones }}</textarea>
  </div>

                          <span class="help-block">Descripción del producto, cualidades y caracteristicas</span>
                        </div>
                      </div>


              <div class="form-group">

                 <div class="col-lg-2 control-label"><label for="Imagenproducto">Imagen</label></div>
                 <div class="col-lg-5"><input type="file"></div>
                 <div class="col-lg-3 "><button type="submit" class="btn btn-primary">Enviar</button><span> </span>
              </div>
                 <br><br><br><br>



                      <div class="form-group">
                        <div class="col-lg-10 col-lg-offset-3">
                          <button type="reset" class="btn btn-default">Cancelar</button>
                          <button type="submit" class="btn btn-primary">Crear</button>
                        </div>
                      </div>
                    </fieldset>
                  </form>
          </div>
        </div>
      </div>

{% endblock %}
{% endblock %}
